!function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d}}(),function(a){a.MAGE={version:"0.0.2",core:{},utils:{}}}(window),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),function(a){a.MAGE.core.Game=Class.extend({init:function(a,b){b=b||{},this.width=b.width||800,this.height=b.height||600,this.clearColor=b.clearColor||"black",this.debugColor=b.debugColor||"white",this.fpsRefreshRate=b.fpsRefreshRate||500,this.debugMode=b.debugMode||!1,this.eventsContainer=b.eventsContainer||a,this.keyboardEventsContainer=b.keyboardEventsContainer||document,this.allowResize=b.allowResize||!0,this.lastRender=0,this.FPS=0,this.tmrFPS=0,this.frameCount=0,this.container=a,this.keyStates={},this.oldKeyStates={},this.buttonStates={},this.oldButtonStates={},this.mousePosition={x:0,y:0},this.containerPosition={x:a.offsetLeft,y:a.offsetTop},this.debugIndicators=[]},initializeAll:function(){this.allowResize&&(window.onresize=function(){this.initContext()}.bind(this)),this.initContext(),this.initListeners(),this.initialize()},initContext:function(){this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.container.setAttribute("width",this.width),this.container.setAttribute("height",this.height),this.context=this.container.getContext("2d")},start:function(){this.initializeAll(),requestAnimFrame(this.loop.bind(this))},initialize:function(){},update:function(a,b){},draw:function(a,b,c,d){},clear:function(a,b){a.fillStyle=b,a.fillRect(0,0,this.width,this.height)},drawDebugMode:function(a,b,c,d){var e=1;a.font="10px sans",a.fillStyle=this.debugColor,a.fillText("Time : "+b.toFixed(2),10,10*e++),a.fillText("Elapsed time : "+c.toFixed(2),10,10*e++),a.fillText("Delta : "+d.toFixed(2),10,10*e++),a.fillText("Tmr FPS : "+this.tmrFPS.toFixed(2),10,10*e++),a.fillText("FPS : "+this.FPS,10,10*e++),e++,this.debugIndicators.forEach(function(b,c){a.fillText(c.title+" : "+c.fn(),10,10*e++)})},loop:function(a){var b=(a-this.lastRender)/16.66666667,c=a-this.lastRender;this.clear(this.context,this.clearColor),this.update(a,b),this.draw(this.context,a,c,b),this.debugMode&&this.drawDebugMode(this.context,a,c,b),this.frameCount++,a>=this.tmrFPS+this.fpsRefreshRate&&(this.tmrFPS=a,this.FPS=this.frameCount*(1e3/this.fpsRefreshRate),this.frameCount=0),this.lastRender=a,this.oldKeyStates=this.clone(this.keyStates),this.oldButtonStates=this.clone(this.buttonStates),requestAnimFrame(this.loop.bind(this))},initListeners:function(){this.initMouseListeners(),this.initKeyboardListeners()},initKeyboardListeners:function(){this.keyboardEventsContainer.onkeydown=function(a){this.keyStates[a.keyCode]=!0}.bind(this),this.keyboardEventsContainer.onkeyup=function(a){this.keyStates[a.keyCode]=!1}.bind(this)},initMouseListeners:function(){this.eventsContainer.onmousedown=function(a){this.buttonStates[a.button]=!0}.bind(this),this.eventsContainer.onmouseup=function(a){this.buttonStates[a.button]=!1}.bind(this),this.eventsContainer.onmousemove=function(a){this.mousePosition={x:a.clientX-this.containerPosition.top,y:a.clientY-this.containerPosition.left}}.bind(this)},isKeyDown:function(a){return!!this.keyStates[a]},isJustKeyDown:function(a){return this.isKeyDown(a)&&!this.oldKeyStates[a]},isJustKeyUp:function(a){return!this.isKeyDown(a)&&!!this.oldKeyStates[a]},isButtonDown:function(a){return!!this.buttonStates[a]},isJustButtonDown:function(a){return this.isButtonDown(a)&&!this.oldButtonStates[a]},isJustButtonUp:function(a){return!this.isButtonDown(a)&&!!this.oldButtonStates[a]},getMousePosition:function(){return this.mousePosition},clone:function(a){return JSON.parse(JSON.stringify(a))},debug:function(a,b){this.debugIndicators.push({title:a,fn:b})}})}(window),function(a){a.MAGE.utils.Sprite=Class.extend({init:function(a,b,c,d){this.img=a,this.rowCount=b,this.colCount=c,this.interval=d,this.tileSize={width:this.img.width/c,height:this.img.height/b},this.current=0,this.tmrStep=Date.now()},step:function(a){Date.now()>this.tmrStep+this.interval&&(this.current+=a,this.current<=0?this.current=this.rowCount*this.colCount-1:this.current%=this.rowCount*this.colCount,this.tmrStep=Date.now())},getCurrentTileRect:function(){return{x:Math.floor(this.current%this.colCount)*this.tileSize.width,y:Math.floor(this.current/this.colCount)*this.tileSize.height,width:this.tileSize.width,height:this.tileSize.height}},draw:function(a,b,c,d,e,f){var g=this.getCurrentTileRect();d=d||this.tileSize.width,e=e||this.tileSize.height,a.drawImage(this.img,g.x,g.y,g.width,g.height,(b-d/2)*f,(c-e/2)*f,d*f,e*f)}})}(window);