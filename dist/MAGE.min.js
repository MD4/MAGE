!function(a){a.MAGE={version:"0.0.1",core:{},utils:{}}}(window),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),function(a){var b=function(a,b){b=b||{},this.width=b.width||800,this.height=b.height||600,this.clearColor=b.clearColor||"black",this.debugColor=b.debugColor||"white",this.fpsRefreshRate=b.fpsRefreshRate||500,this.debugMode=b.debugMode||!1,this.eventsContainer=b.eventsContainer||a,this.keyboardEventsContainer=b.keyboardEventsContainer||document,this.allowResize=b.allowResize||!0,this.lastRender=0,this.FPS=0,this.tmrFPS=0,this.frameCount=0,this.container=a,this.keyStates={},this.oldKeyStates={},this.buttonStates={},this.oldButtonStates={},this.mousePosition={x:0,y:0},this.containerPosition={x:a.offsetLeft,y:a.offsetTop},this.debugIndicators=[]};b.prototype.initializeAll=function(){this.allowResize&&(window.onresize=function(){this.initContext()}.bind(this)),this.initContext(),this.initListeners(),this.initialize()},b.prototype.initContext=function(){this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.container.setAttribute("width",this.width),this.container.setAttribute("height",this.height),this.context=this.container.getContext("2d")},b.prototype.start=function(){this.initializeAll(),requestAnimFrame(this.loop.bind(this))},b.prototype.initialize=function(){},b.prototype.update=function(a,b){},b.prototype.draw=function(a,b,c,d){},b.prototype.clear=function(a,b){a.fillStyle=b,a.fillRect(0,0,this.width,this.height)},b.prototype.drawDebugMode=function(a,b,c,d){var e=1;a.font="10px sans",a.fillStyle=this.debugColor,a.fillText("Time : "+b.toFixed(2),10,10*e++),a.fillText("Elapsed time : "+c.toFixed(2),10,10*e++),a.fillText("Delta : "+d.toFixed(2),10,10*e++),a.fillText("Tmr FPS : "+this.tmrFPS.toFixed(2),10,10*e++),a.fillText("FPS : "+this.FPS,10,10*e++),e++,this.debugIndicators.forEach(function(b,c){a.fillText(c.title+" : "+c.fn(),10,10*e++)})},b.prototype.loop=function(a){var b=(a-this.lastRender)/16.66666667,c=a-this.lastRender;this.clear(this.context,this.clearColor),this.update(a,b),this.draw(this.context,a,c,b),this.debugMode&&this.drawDebugMode(this.context,a,c,b),this.frameCount++,a>=this.tmrFPS+this.fpsRefreshRate&&(this.tmrFPS=a,this.FPS=this.frameCount*(1e3/this.fpsRefreshRate),this.frameCount=0),this.lastRender=a,this.oldKeyStates=this.clone(this.keyStates),this.oldButtonStates=this.clone(this.buttonStates),requestAnimFrame(this.loop.bind(this))},b.prototype.initListeners=function(){this.initMouseListeners(),this.initKeyboardListeners()},b.prototype.initKeyboardListeners=function(){this.keyboardEventsContainer.onkeydown=function(a){this.keyStates[a.keyCode]=!0}.bind(this),this.keyboardEventsContainer.onkeyup=function(a){this.keyStates[a.keyCode]=!1}.bind(this)},b.prototype.initMouseListeners=function(){this.eventsContainer.onmousedown=function(a){this.buttonStates[a.button]=!0}.bind(this),this.eventsContainer.onmouseup=function(a){this.buttonStates[a.button]=!1}.bind(this),this.eventsContainer.onmousemove=function(a){this.mousePosition={x:a.clientX-this.containerPosition.top,y:a.clientY-this.containerPosition.left}}.bind(this)},b.prototype.isKeyDown=function(a){return!!this.keyStates[a]},b.prototype.isJustKeyDown=function(a){return this.isKeyDown(a)&&!this.oldKeyStates[a]},b.prototype.isJustKeyUp=function(a){return!this.isKeyDown(a)&&!!this.oldKeyStates[a]},b.prototype.isButtonDown=function(a){return!!this.buttonStates[a]},b.prototype.isJustButtonDown=function(a){return this.isButtonDown(a)&&!this.oldButtonStates[a]},b.prototype.isJustButtonUp=function(a){return!this.isButtonDown(a)&&!!this.oldButtonStates[a]},b.prototype.getMousePosition=function(){return this.mousePosition},b.prototype.clone=function(a){return JSON.parse(JSON.stringify(a))},b.prototype.debug=function(a,b){this.debugIndicators.push({title:a,fn:b})},a.MAGE.core.Game=b}(window),function(a){var b=function(a,b,c,d){this.img=a,this.rowCount=b,this.colCount=c,this.interval=d,this.tileSize={width:this.img.width/c,height:this.img.height/b},this.current=0,this.tmrStep=Date.now()};b.prototype.step=function(a){Date.now()>this.tmrStep+this.interval&&(this.current+=a,this.current<=0?this.current=this.rowCount*this.colCount-1:this.current%=this.rowCount*this.colCount,this.tmrStep=Date.now())},b.prototype.getCurrentTileRect=function(){return{x:Math.floor(this.current%this.colCount)*this.tileSize.width,y:Math.floor(this.current/this.colCount)*this.tileSize.height,width:this.tileSize.width,height:this.tileSize.height}},b.prototype.draw=function(a,b,c,d,e,f){var g=this.getCurrentTileRect();d=d||this.tileSize.width,e=e||this.tileSize.height,a.drawImage(this.img,g.x,g.y,g.width,g.height,(b-d/2)*f,(c-e/2)*f,d*f,e*f)},a.MAGE.utils.Sprite=b}(window);